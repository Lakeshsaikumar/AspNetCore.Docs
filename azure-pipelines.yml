trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

steps:
# Install .NET SDK
- task: UseDotNet@2
  inputs:
    packageType: 'sdk'
    version: '8.x'   # Change if needed
    includePreviewVersions: true

# Restore, Build, Test, Publish from the sample folder
- script: |
    dotnet restore
    dotnet build --configuration Release
    dotnet test --configuration Release --no-build
    dotnet publish --configuration Release -o $(Build.ArtifactStagingDirectory)
  workingDirectory: aspnetcore/tutorials/first-mvc-app/start-mvc/sample
  displayName: 'Restore, Build, Test & Publish'

# Publish artifacts for release pipeline
- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    ArtifactName: 'MvcSampleWebApp'
    publishLocation: 'Container'
